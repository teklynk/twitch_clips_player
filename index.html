<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Twitch Clips Player</title>
    <meta name="description" content="This is a Twitch Clips Player, browser source overlay for OBS. Automatically play clips from your channel or other channels. Keep your viewers entertained on your BRB or starting soon scenes." />
    <meta name="keywords" content="Twitch, clips player, overlay" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Twitch Clips Player" />
    <meta property="og:description" content="This is a Twitch Clips Player, browser source overlay for OBS. Automatically play clips from your channel or other channels. Keep your viewers entertained on your BRB or starting soon scenes." />
    <meta property="og:url" content="" />
    <meta property="og:site_name" content="Twitch Clips Player" />
    <script src="assets/js/jquery-3.6.0.min.js"></script>
    <script src="assets/js/bootstrap.bundle.js"></script>
    <script async defer src="https://buttons.github.io/buttons.js"></script>
    <link rel="stylesheet" href="assets/css/bootstrap452.min.css">
    <link rel="stylesheet" href="assets/css/dark.min.css">
    <link rel="apple-touch-icon" sizes="57x57" href="assets/images/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="assets/images/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="assets/images/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="assets/images/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="assets/images/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="assets/images/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="assets/images/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="assets/images/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="assets/images/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192" href="assets/images/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="assets/images/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="assets/images/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="assets/images/favicon-16x16.png">
</head>
<style>
    .hide {
        display: none;
    }
    .ml-0 {
        margin-left: 0 !important;
    }
    .ml-4 {
        margin-left: 1.5rem !important;
    }
    .pl-0 {
        padding-left: 0 !important;
    }
    .pr-0 {
        padding-right: 0 !important;
    }
    .dark-blue {
        background-color: #1b2836 !important;
        color: #fff !important;
    }
    .light-blue {
        background-color: #354e69 !important;
        color: #fff !important;
    }
</style>
<body onload="onInit()">
<div class="container">
    <div class="row pt-md-4">
        <ul class="nav nav-pills">
            <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle active" data-toggle="dropdown" href="#" role="button"
                   aria-haspopup="true" aria-expanded="false">Twitch Tools</a>
                <div class="dropdown-menu" id="main-nav">
                </div>
            </li>
        </ul>
    </div>
    <div class="row">
        <div class="col-10">
            <h1 class="h3 pt-4 pl-lg-4 text-center">Twitch Clips Player</h1>
        </div>
        <div class="col-2 text-center">
            <img src="assets/images/robot.gif" style="width: 60px;" alt="tekbot_v1" title="Hi, I'm tekbot_v1" id="tekbotImg" onmouseover="onHover();" onmouseout="offHover();">
        </div>
    </div>
    <br>
    <div class="card">
        <div class="card-body">
            <a class="github-button" href="https://github.com/teklynk/twitch_clips_player/fork" data-color-scheme="no-preference: light; light: light; dark: dark;" data-size="large" data-show-count="true" aria-label="">Fork</a>
            <a class="github-button" href="https://github.com/teklynk/twitch_clips_player" data-color-scheme="no-preference: light; light: light; dark: dark;" data-icon="octicon-star" data-size="large" data-show-count="true" aria-label="">Star</a>
            <h2>Twitch Clips Player Overlay</h2>
            <p>This grabs your Twitch clips and plays them one after the other in a loop. Keep your viewers entertained on your BRB or starting soon scenes.</p> 
            <span class="text-info">FEATURES:</span>
            <ul>
                <li><strong>Control your clips:</strong> Use !clipskip, !clippause, !clipplay, or !clipreload. Only mods and streamer can use these commands.</li>
                <li><strong>Show clips from channels that you follow.</strong></li>
                <li><strong>Custom command:</strong> Start or stop the clip reel with a custom command. Command is restricted to mods and streamer only.</li>
                <li><strong>Type "!mycommand stop" in chat:</strong> Stop the clip reel without background play</li>
                <li><strong>Show clip details panel:</strong> Open a panel displaying clip details about your favorite clip. Use variables: {channel}, {title}, {game}, {creator_name}, {created_at} to change the default text.</li>
            </ul>
            <span class="text-info">Date Range:</span>
            <ul>
                <li>Select from 10 days, 30 days, 90 days... If no clips are found, show a clip from the top most popular clips.</li>
            </ul>
            <span class="text-info">For OBS:</span>
            <ul>
                <li><strong>Shutdown source:</strong> Set to "Stop video when not visible"</li>
                <li><strong>Refresh:</strong> Refresh browser when scene becomes active</li>
            </ul>
        </div>
    </div>
    <br>
    <div class="card dark-blue">
        <div class="card-body">
            <h5 class="card-title">Supporting This Project</h5>
            <p class="card-text">
                As a volunteer developer, I'm proud to maintain and improve this open-source project. To continue providing a reliable and feature-rich experience, I need your help. Our backend server, which fetches API data, incurs costs that need to be covered.
            </p>
            <p>
                If you find this project valuable and enjoy using it, please consider making a donation to help offset these expenses. Your contribution will directly support the project's growth and ensure its continued availability.
            </p>
            <span class="text-info">Your Donation Will Help</span>
            <ul>
                <li>Keep the server running smoothly</li>
                <li>Cover costs and maintenance</li>
                <li>Support ongoing development and improvements</li>
                <li>Ensure a reliable experience for all users</li>
            </ul>
            <p>
                Thank you for your support, and I'm grateful for your enthusiasm for this project.
            </p>
            <p>
                If you need more details on how to donate or have any questions, feel free to ask.
            </p>
            <div class="text-left mt-4">
                <div class="btn-container ml-0 pl-0">
                    <script type='text/javascript' src='https://storage.ko-fi.com/cdn/widget/Widget_2.js'></script>
                    <script type='text/javascript'>kofiwidget2.init('Donate', '#191d21', 'O4O0BWF2E');kofiwidget2.draw();</script>
                </div>
                <div class="btn-container">
                    <script type='text/javascript' src="https://liberapay.com/teklynkliberapay/widgets/button.js"></script>
                    <noscript><a href="https://liberapay.com/teklynkliberapay/donate"><img alt="Donate using Liberapay" src="https://liberapay.com/assets/widgets/donate.svg"></a></noscript>
                </div>
                <div class="btn-container btn btn-link">
                    <a href="https://www.paypal.com/donate/?hosted_button_id=UVKZUYFMXQDPL" target="_blank">Paypal</a>
                </div>
            </div>
        </div>
    </div>
    <br>
    <div class="card light-blue">
        <div class="card-body">
            <h5 class="card-title">Disclaimer</h5>
            <ul>
                <li>The clips player may not function smoothly if you use multiple channels, which could result in temporary slowness between clips.</li>
                <li><strong>Date range and featured clips:</strong> The clips player will try to find and play clips that meet these criteria first. If no clips are found, then it will attempt to display clips from the top most popular. Keep in mind that if you set a date range and/or limit to featured clips, there may be a possibility of displaying only a small number of clips.</li>
            </ul>
        </div>
    </div>
    <br>
    <div class="alert alert-dark" role="alert">Access Token is now required if you would like to show clips from channels that you follow.<br>
        <div class="form-label-group mb-4">
            <div class="mb-2">
                <a href="https://id.twitch.tv/oauth2/authorize?response_type=token&client_id=cuql1zod4eeabjr3cnc6adjn9ezro4&redirect_uri=https://twitch-clips-player.pages.dev&scope=chat:read+chat:edit+user:read:follows+moderator:read:followers&force_verify=true"
                   target="_self"><img src="assets/images/connect.png"></a>
            </div>
            <label for="ref">Access token</label>
            <input type="password" id="ref" class="form-control">
            <span id="show_ref"
                  style="cursor:pointer;text-align:left;display:inline-block;width:70px;margin-top: 4px;font-size:smaller;vertical-align:top;"
                  title="Show/Hide">show
            </span>
            </div>
    </div>
    
    <div class="form-label-group mb-2">
        <label for="mainChannel">Main Twitch Channel</label>
        <input type="text" id="mainChannel" class="form-control" value="" placeholder="MrCoolStreamer" size="50">
    </div>
    <div class="form-label-group mb-2">
        <label for="channel">Twitch channel(s) to pull clips from
            <small class="text-warning">* This can be a single channel or a comma separated list of channels</small>
        </label>
        <textarea id="channel" rows="3" class="form-control" style="min-height: 100px;"
               placeholder="MrCoolStreamer,GamerGamingGames,StreamBean,AnotherStreamer,WillStreamForBeer"></textarea>
    </div>
    <div class="form-check mb-2">
        <input class="form-check-input" type="checkbox" value="" id="showFollowing">
        <label class="form-check-label" for="showFollowing">
            Show clips from channels that you follow <small class="text-warning">* Requires Twitch Access Token</small>
        </label>
    </div>
    <div class="form-label-group mb-2 hide" id="showExclude"> 
        <label for="exclude">Exclude channels
            <small class="text-warning">* Comma separated list of channels</small>
        </label>
        <textarea id="exclude" rows="3" class="form-control" style="min-height: 100px;"
               placeholder="MrCoolStreamer,GamerGamingGames,StreamBean,AnotherStreamer,WillStreamForBeer"></textarea>
    </div>
    <div class="form-label-group mb-4" id="customCommandOptions">
        <div class="form-label-group mb-2">
            <label for="command">Custom Command <small>(Optional)</small>
                <small class="text-warning">* If a custom command is Not set, the clips player will start playing as soon as the scene is active.</small>
            </label>
            <input type="text" id="command" class="form-control" value="" placeholder="playclips" size="50">
        </div>
    </div>
    <div class="form-group range-slider mt-4">
        <label for="limit">Max Number of clips to pull
            <small>(Max is 100)</small>
        </label>
        <input type="range" max="100" min="0" step="10" class="form-control range-slider-range" id="limit"
               value="20" style="height: 0;">
        <small class="text-muted range-slider-value"></small>
        <small class="text-muted range-slider-value">Clips</small>
    </div>
    <div class="form-group range-slider mt-4">
        <label for="dateRange">Only show clips from within a Date Range (Date range clips if found) <small class="text-warning">* 0 Day(s) = OFF</small>
        </label>
        <input type="range" max="360" min="0" step="10" class="form-control range-slider-range" id="dateRange"
               value="0" style="height: 0;">
        <small class="text-muted range-slider-value"></small>
        <small class="text-muted range-slider-value">Day(s)</small>
    </div>
    <div class="form-check mb-2">
        <input class="form-check-input" type="checkbox" value="" id="preferFeatured">
        <label class="form-check-label" for="preferFeatured">
            Prefer featured clips (Featured clips if found)
        </label>
    </div>
    <div class="form-check mb-2">
        <input class="form-check-input" type="checkbox" value="" id="showText" checked>
        <label class="form-check-label" for="showText">
            Show channel name on top of video
        </label>
    </div>
    <div class="form-label-group mt-2 mb-4 ml-4" id="showCustomText" checked>
        <label for="customText">Custom message <small>(Optional)</small>
        </label>
        <input type="text" id="customText" class="form-control" value=""
               placeholder="Go check out {channel}" size="255">
    </div>
    <div class="form-check mb-2">
        <input class="form-check-input" type="checkbox" value="" id="showDetails" checked>
        <label class="form-check-label" for="showDetails">
            Show clip details panel
        </label>
    </div>
    <div class="form-label-group mt-2 mb-4 ml-4" id="showDetailsText" checked>
        <label for="detailsText">Custom clip details panel text <small>(Optional)</small>
        </label>
        <textarea class="form-control" id="detailsText" rows="4" placeholder="{title}
While streaming {game}
Clipped by {creator_name} {created_at}"></textarea>
    </div>
    <div class="form-group">
        <label for="themeOption">Theme options</label>
        <select class="form-control" id="themeOption">
            <option value="0">None</option>
            <option value="1">Slide in fancy skewed</option>
            <option value="2" selected>Slide in basic</option>
            <option value="3">Outside the box</option>
        </select>
    </div>
    <br>
    <button class="btn btn-lg btn-success btn-block" id="generate_button" type="button">Generate Overlay Link</button>
    <br>
    <div id="overlaylink" class="hide"></div>
</div>
<script>
    function onInit() {

        let url = window.location.href;

        if (url.indexOf('#access_token') !== -1) {
            // extract the access_token from the url
            let access_token = new URL(url).hash.split('&').filter(function (el) {
                if (el.match('access_token') !== null) return true;
            })[0].split('=')[1];
            // fill input with token value
            document.getElementById("ref").value = access_token;
            // Save token to localstorage
            localStorage.setItem("TwitchClipsRef", access_token);
            // Redirect to default page after getting token
            window.location.href = "https://twitch-clips-player.pages.dev";
        } else {
            document.getElementById("ref").value = localStorage.getItem("TwitchClipsRef");
        }

        let rangeSlider = function rangeSlider() {
            let slider = $('.range-slider'),
                range = $('.range-slider-range'),
                value = $('.range-slider-value');

            slider.each(function () {

                value.each(function () {
                    let value = $(this).prev().attr('value');
                    $(this).html(value);
                });

                range.on('input', function () {
                    $(this).next(value).html(this.value);
                });
            });
        };

        // Auto grow textarea onload
        document.getElementById("channel").style.height = "";
        document.getElementById("channel").style.height = Math.min(document.getElementById("channel").scrollHeight, 300) + "px";

        rangeSlider();
    }

    // Auto grow textarea on input change
    document.getElementById("channel").oninput = function() {
        document.getElementById("channel").style.height = "";
        document.getElementById("channel").style.height = Math.min(document.getElementById("channel").scrollHeight, 300) + "px";
    };

    // Check if any input fields have changed
    $(":text,textarea,select,:checkbox,input[type=range],input[type=password]").on('change', function (e) {
        $("#overlaylink").addClass("hide");
    });

    //show following
    document.getElementById("showFollowing").addEventListener("click", function (e) {
        document.getElementById("channel").toggleAttribute('disabled');
    }, false);

    // show custom text input
    document.getElementById("showText").addEventListener("click", function (e) {
        document.getElementById("showCustomText").classList.toggle('hide');
    }, false);

    // show custom details input
    document.getElementById("showDetails").addEventListener("click", function (e) {
        document.getElementById("showDetailsText").classList.toggle('hide');
    }, false);

    // show custom details input
    document.getElementById("showFollowing").addEventListener("click", function (e) {
        document.getElementById("showExclude").classList.toggle('hide');
    }, false);

    document.getElementById("show_ref").addEventListener("click", function (e) {
        if (document.getElementById("show_ref").innerText === "hide") {
            document.getElementById("show_ref").innerText = "show";
            document.getElementById("ref").setAttribute('type', 'password');
        } else {
            document.getElementById("show_ref").innerText = "hide";
            document.getElementById("ref").setAttribute('type', 'text');
        }
    }, false);

    document.getElementById("generate_button").addEventListener("click", function (e) {
        let channel = document.getElementById("channel").value.trim();
        channel = channel.replace(/\s+/g, ""); // remove white space
        let mainChannel = document.getElementById("mainChannel").value.trim();
        let exclude = document.getElementById("exclude").value.trim();
        exclude = exclude.replace(/\s+/g, ""); // remove white space
        let ref = document.getElementById("ref").value.trim();
        let limit = document.getElementById("limit").value;
        let dateRange = document.getElementById("dateRange").value;
        let themeOption = document.getElementById("themeOption").value;
        let preferFeatured = document.getElementById("preferFeatured").checked;
        let showText = document.getElementById("showText").checked;
        let showDetails = document.getElementById("showDetails").checked;
        let showFollowing = document.getElementById("showFollowing").checked;
        let command = document.getElementById("command").value.trim();
        command = command.replace('!', '');
        let customText = document.getElementById("customText").value.trim();
        let detailsText = document.getElementById("detailsText").value.trim();
        let clientId = 'cuql1zod4eeabjr3cnc6adjn9ezro4';
        let validationError = false;

        if (showFollowing) {
            channel = '';
        }

        if (showFollowing && !ref) {
            alert('Twitch access token is required if show following is checked!');
        }

        if (!mainChannel) {
            alert('Twitch main channel is not set');
        }

        if (command && !mainChannel) {
            alert('Twitch main channel is not set');
        }

        if (showFollowing && !mainChannel) {
            alert('Twitch main channel is not set');
        }

        if (!channel && !showFollowing) {
            alert('Twitch channel(s) is not set or Show clips from channels that you follow is not checked');
        }

        let hardCodedCommands = ['clipplay', 'clippause', 'clipskip', 'clipreload'];

        if (hardCodedCommands.includes(command)) {
            alert(command + ' can not be used. It is a reserved command. Please choose a different command name.');
        }

        if (showDetails && !detailsText) {
             detailsText = "{title}\nWhile streaming {game}\nClipped by {creator_name} {created_at}";
        }

        if (showFollowing === false) {
            clientId = '';
            ref = '';
        }

        if (showFollowing === false) {
            exclude = '';
            clientId = '';
        }

        function validateForm() {
            const mainChannelInput = document.getElementById('mainChannel');
            const channelInput = document.getElementById('channel');
            const mainChannelValue = mainChannelInput.value;
            const channelValue = channelInput.value;
            const inputKeywords = ['http', 'https', 'twitch.tv'];

            inputKeywords.forEach(keyword => {
                if (mainChannelValue.includes(keyword) || channelValue.includes(keyword)) {
                    alert(`Invalid input: Channel name cannot contain "${keyword}".`);
                    validationError = true;
                    return false;
                }
            });

            return true;
        }

        validateForm();

        if (!validationError) {
            // build overlay url
            let srcURL = window.location.protocol + "//" + window.location.host + window.location.pathname;
            let fullUrl = srcURL + "clips.html?channel=" + channel + "&exclude=" + exclude + "&limit=" + limit + "&dateRange=" + dateRange + "&themeOption=" + themeOption + "&preferFeatured=" + preferFeatured + "&showText=" + showText + "&showDetails=" + showDetails + "&detailsText=" + encodeURIComponent(detailsText) + "&mainAccount=" + mainChannel + "&command=" + command + "&customText=" + encodeURIComponent(customText) + "&showFollowing=" + showFollowing + "&ref=" + btoa(ref) + "&clientId=" + btoa(clientId);
            fullUrl = fullUrl.replace("index.htmlclips.html", "clips.html");
            document.getElementById("overlaylink").classList.remove("hide");
            document.getElementById("overlaylink").innerHTML = "<p>Add this link as a browser source in OBS.<br>" + 
                "<a style='word-break:break-all;' href='" + fullUrl + "' target='_blank'>" + fullUrl + "</a><br><span class='text-warning'><small>* Never share this url with anyone or show it on stream!</small></span></p>";
        }
        
    });
</script>
<div class="text-right m-4">
    <a class="btn btn-link" href="https://github.com/teklynk/twitch_clips_player/blob/main/README.md"
       target="_blank">Help</a>
    <a class="btn btn-link" href="https://github.com/teklynk/twitch_clips_player" target="_blank">Github</a>
    <div class="btn-container">
        <script type='text/javascript' src='https://storage.ko-fi.com/cdn/widget/Widget_2.js'></script>
        <script type='text/javascript'>kofiwidget2.init('Donate', '#191d21', 'O4O0BWF2E');kofiwidget2.draw();</script>
    </div>
    <div class="btn-container">
        <script type='text/javascript' src="https://liberapay.com/teklynkliberapay/widgets/button.js"></script>
        <noscript><a href="https://liberapay.com/teklynkliberapay/donate"><img alt="Donate using Liberapay" src="https://liberapay.com/assets/widgets/donate.svg"></a></noscript>
    </div>
    <div class="btn-container btn btn-link">
        <a href="https://www.paypal.com/donate/?hosted_button_id=UVKZUYFMXQDPL" target="_blank">Paypal</a>
    </div>
</div>
<script>
    // tekbot_v1 mouse hover action
    function onHover() {
        $("#tekbotImg").attr('src', 'assets/images/robot_loop.gif');
    }
    function offHover() {
        $("#tekbotImg").attr('src', 'assets/images/robot.gif');
    }

    // Json data - Ajax call
    let nav_json = JSON.parse($.getJSON({
        'url': "https://twitchapi.teklynk.com/getnav.php",
        'async': false
    }).responseText);

    $.each(nav_json, function (i, val) {
        $('<a class="dropdown-item" href="' + val.url + '">' + val.name + '</a>').appendTo('#main-nav');
    });
</script>
<style>
    .btn-container {
        min-width: auto !important;
        padding-left: 20px;
    }
    span.kofitext {
        color: #adb5bd !important;
    }
    a.kofi-button {
        border-radius: none;
        box-shadow: none !important;
        min-width: auto !important;
        padding: 0 !important;
        line-height: unset !important;
    }
</style>
<!-- Github Corner Ribbon - to remove (Ribbon created with : http://tholman.com/github-corners/ )-->
<a href="https://github.com/teklynk/twitch_clips_player" target="_blank" class="github-corner" aria-label="View source on Github" title="View source on Github"><svg width="80" height="80" viewBox="0 0 250 250" style="z-index:99999; fill:#70B7FD; color:#fff; position: fixed; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}@media only screen and (max-width:680px){ .github-corner > svg { right: auto!important; left: 0!important; transform: rotate(270deg)!important;}}</style>
<!-- END Github Corner Ribbon - to remove -->
</body>
</html>